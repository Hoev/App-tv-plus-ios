<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TV Player</title>

  <!-- مكتبات -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.1/shaka-player.compiled.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
  <script src="//content.jwplatform.com/libraries/SAHhwvZq.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: black;
      overflow: hidden;
    }
    #player {
      width: 100% !important;
      height: 100% !important;
      outline: none;
    }

    /* تكبير الأزرار */
    .jw-controlbar .jw-icon-inline,
    .jw-controlbar .jw-icon-tooltip {
      width: 60px !important;
      height: 60px !important;
    }
    .jw-controlbar .jw-icon-inline .jw-svg-icon,
    .jw-controlbar .jw-icon-tooltip .jw-svg-icon {
      width: 30px !important;
      height: 30px !important;
    }

    /* تأثير التركيز لريموت */
    .jw-controlbar .jw-icon-inline.focused,
    .jw-controlbar .jw-icon-tooltip.focused {
      outline: 3px solid #f44336;
      box-shadow: 0 0 10px #f44336;
    }

    /* إزالة أي شريط تحميل */
    .jw-spinner,
    .jw-loading,
    .jw-display-icon-container {
      display: none !important;
    }
  </style>
</head>
<body>

  <div id="player" tabindex="0"></div>

  <script>
    document.addEventListener("DOMContentLoaded", async function () {

      // ملء الشاشة + Landscape
      const elt = document.documentElement;
      if (elt.requestFullscreen) { try { await elt.requestFullscreen(); } catch(e){} }
      if (screen.orientation && screen.orientation.lock) {
        try { await screen.orientation.lock('landscape'); } catch(e){}
      }

      // مفتاح JW Player
      jwplayer.key = 'XSuP4qMl+9tK17QNb+4+th2Pm9AWgMO/cYH8CI0HGGr7bdjo';

      // رابط البث (m3u8)
      const streamUrl = "https://stream.supertv.gg:3001/supertv/sport/stv1/ch1/adaptive.m3u8";

      const data = {
        stream_url: streamUrl,
        drm_keys: null // لا يوجد DRM
      };

      setupJWPlayer(data);
    });

    function setupJWPlayer(data) {
      const playerInstance = jwplayer("player");

      playerInstance.setup({
        width: "100%",
        height: "100%",
        controls: true,
        stretching: "uniform",
        autostart: true,
        mute: false,
        volume: 50,

        playlist: [{
          sources: [{
            file: data.stream_url,
            type: data.stream_url.endsWith(".mpd") ? "dash" : "hls",
            drm: {},
            label: "HD"
          }]
        }]
      });

      const expandSvg = `
        <svg fill="#ffffff" version="1.1" width="24" height="24" 
        viewBox="0 0 100 100"></svg>`;

      playerInstance.on("ready", function () {

        // زر التوسيع
        playerInstance.addButton(
          expandSvg,
          "توسيع الفيديو",
          function () {
            const vid = document.querySelector("#player video");
            if (!vid) return;
            vid.style.objectFit = (vid.style.objectFit === "contain") ? "fill" : "contain";
          },
          "jw-expandButton"
        );

        // دعم الريموت (تنقل الأسهم)
        const controlBar = document.querySelector('.jw-controlbar');
        if (controlBar) {
          const buttons = controlBar.querySelectorAll('.jw-icon-inline, .jw-icon-tooltip');
          buttons.forEach(btn => {
            btn.setAttribute('tabindex', '0');
            btn.addEventListener('focus', () => btn.classList.add('focused'));
            btn.addEventListener('blur',  () => btn.classList.remove('focused'));
          });

          document.addEventListener('keydown', (evt) => {
            const focusable = Array.from(controlBar.querySelectorAll('[tabindex="0"]'));
            const idx = focusable.indexOf(document.activeElement);
            let nextIdx;
            if (evt.key === 'ArrowRight') nextIdx = (idx + 1) % focusable.length;
            else if (evt.key === 'ArrowLeft') nextIdx = (idx - 1 + focusable.length) % focusable.length;
            else return;
            focusable[nextIdx].focus();
            evt.preventDefault();
          });

          const firstBtn = controlBar.querySelector('[tabindex="0"]');
          if (firstBtn) firstBtn.focus();
        }
      });
    }
  </script>

</body>
</html>