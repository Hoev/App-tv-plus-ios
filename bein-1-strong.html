<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TV Player</title>
  <!-- مكتباتك الأصلية -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.1/shaka-player.compiled.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
  <script src="//content.jwplatform.com/libraries/SAHhwvZq.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: black;
      overflow: hidden;
    }
    /* حاوية المشغل لجعلها relative */
    #player {
      width: 100% !important;
      height: 100% !important;
      outline: none;
      position: relative;
    }
    /* رابط TV PLUS داخل المشغل */
    .tv-plus-link {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 9999;
      color: gold;
      font-size: 24px;
      font-weight: bold;
      text-decoration: none;
      cursor: pointer;
    }
    /* تكبير الأزرار */
    .jw-controlbar .jw-icon-inline,
    .jw-controlbar .jw-icon-tooltip {
      width: 60px !important;
      height: 60px !important;
    }
    .jw-controlbar .jw-icon-inline .jw-svg-icon,
    .jw-controlbar .jw-icon-tooltip .jw-svg-icon {
      width: 30px !important;
      height: 30px !important;
    }
    /* تأثير التركيز لعنصر الريموت */
    .jw-controlbar .jw-icon-inline.focused,
    .jw-controlbar .jw-icon-tooltip.focused {
      outline: 3px solid #f44336;
      box-shadow: 0 0 10px #f44336;
    }
  </style>
</head>
<body>
  <!-- عنصر القناة -->
  <a href="go:telegram" class="tv-plus-link" target="_blank">TV PLUS</a>
  <div id="player" tabindex="0"></div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      jwplayer.key = 'XSuP4qMl+9tK17QNb+4+th2Pm9AWgMO/cYH8CI0HGGr7bdjo';

      const streamUrl   = "https://akomov.com/ako_admin/cod/channel.php?id=5003167";
      const drmKeyId    = "de2e89e6e7fd3fd7b564a1ae4d019968";
      const drmKeyValue = "543b39583fea54c70fb6e9186da930ca";
      const channelData = { stream_url: streamUrl, drm_keys: { [drmKeyId]: drmKeyValue } };

      const playerInstance = jwplayer("player");
      playerInstance.setup({
        width: "100%",
        height: "100%",
        controls: true,
        stretching: "uniform",
        autostart: true,
        mute: false,
        volume: 50,
        horizontalVolumeSlider: true,
        playbackRateControls: true,
        playbackRates: [0.5, 1, 1.25, 1.5, 2],
        logo: { file: "", link: "", hide: false, position: "bottom-left", margin: 20 },
        aspectratio: "16:9",
        playlist: [{
          sources: [{
            file: channelData.stream_url,
            type: "dash",
            drm: { clearkey: { keyId: Object.keys(channelData.drm_keys)[0], key: Object.values(channelData.drm_keys)[0] } }
          }]
        }]
      });

      playerInstance.on("ready", function () {
        // إضافة رابط TV PLUS داخل حاوية المشغل
        const container = playerInstance.getContainer();
        const link = document.querySelector('.tv-plus-link');
        if (container && link) {
          container.appendChild(link);
        }

        // تشغيل ملء الشاشة للمشغل تلقائياً
        try {
          playerInstance.setFullscreen(true);
        } catch (e) {
          console.warn('تعذّر تفعيل ملء الشاشة:', e);
        }

        // اختيار أعلى دقة متاحة تلقائياً
        const levels = playerInstance.getQualityLevels();
        if (levels && levels.length) {
          // إيجاد أعلى دقة حسب الارتفاع
          const highest = levels.reduce((prev, curr) => (curr.height > prev.height ? curr : prev));
          const highestIndex = levels.indexOf(highest);
          playerInstance.setCurrentQuality(highestIndex);
        }

        // تكبير الأزرار وإعداد التركيز والتنقل
        const controlBar = document.querySelector('.jw-controlbar');
        if (controlBar) {
          const buttons = controlBar.querySelectorAll('.jw-icon-inline, .jw-icon-tooltip');
          buttons.forEach(btn => {
            btn.setAttribute('tabindex', '0');
            btn.addEventListener('focus', () => btn.classList.add('focused'));
            btn.addEventListener('blur',  () => btn.classList.remove('focused'));
          });
          document.addEventListener('keydown', (evt) => {
            const focusable = Array.from(controlBar.querySelectorAll('[tabindex="0"]'));
            const idx = focusable.indexOf(document.activeElement);
            let nextIdx;
            if (evt.key === 'ArrowRight')      nextIdx = (idx + 1) % focusable.length;
            else if (evt.key === 'ArrowLeft')  nextIdx = (idx - 1 + focusable.length) % focusable.length;
            else return;
            focusable[nextIdx].focus();
            evt.preventDefault();
          });
          const firstBtn = controlBar.querySelector('[tabindex="0"]');
          if (firstBtn) firstBtn.focus();
        }

        // إدارة قفل orientation في fullscreen
        playerInstance.on('fullscreen', async function(isFullscreen) {
          if (isFullscreen) {
            if (screen.orientation && screen.orientation.lock) {
              try { await screen.orientation.lock('landscape'); } catch (e) { console.warn(e); }
            }
          } else {
            if (screen.orientation && screen.orientation.unlock) {
              try { await screen.orientation.unlock(); } catch (e) { console.warn(e); }
            }
          }
        });
      });
    });
  </script>
</body>
</html>